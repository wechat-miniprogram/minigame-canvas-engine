<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta name="robots" content="all"><meta name="author" content="yuanzm"><meta name="keywords" content="minigame-canvans-engine, minigame, canvas, engine, game engine"><link rel="shortcut icon" type="image/x-icon" href="./imgs/favicon.ico"><script>
  var sc_project=12873270; 
  var sc_invisible=1; 
  var sc_security="efed24b4"; 
  </script><script src="https://www.statcounter.com/counter/counter.js" async></script><title>缓动系统</title><meta name="description" content="轻量级canvas渲染引擎">
    <link rel="preload" href="/minigame-canvas-engine/assets/style-DEIxwZe7.css" as="style"><link rel="stylesheet" href="/minigame-canvas-engine/assets/style-DEIxwZe7.css">
    <link rel="modulepreload" href="/minigame-canvas-engine/assets/app-BF_eLkLB.js"><link rel="modulepreload" href="/minigame-canvas-engine/assets/tween.html-BpQfMzk6.js">
    <link rel="prefetch" href="/minigame-canvas-engine/assets/CHANGELOG.html-C8X5RIxA.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/index.html-BWQPP1Bi.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/api.html-BlCiBvHH.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/style.html-D4ItSLwJ.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/tags.html-CSDimcCI.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/invite.html-Bq3n47fK.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/rank.html-BkcoettM.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/bitmapfont.html-DMzdcgHp.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/button.html-LJpZWi9y.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/canvas.html-prgIpnKh.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/element.html-BIKdp2OD.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/image.html-BT_ur038.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/overview.html-HgVOF-BP.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/rect.html-D1R8K7DL.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/scrollbar.html-BJA_P1Mi.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/scrollview.html-Bj4QS2F0.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/text.html-CVe_XjbM.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/view.html-CNRCCpIu.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/guide.html-wkkQRaeY.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/plugin.html-OBT7XXsA.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/guide.html-iqYoxaBe.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/richtext.html-B5OmLIAh.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/cocos2.x.html-n3TgiLbv.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/loading.html-DIWOWA0g.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/platform.html-CVDeZDuu.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/templateengine.html-Ck39s4SL.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/updateViewPort.html-mxUEIYCj.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/404.html-DFx53n_m.js" as="script"><link rel="prefetch" href="/minigame-canvas-engine/assets/setupDevtools-7MC2TMWH-CRd08367.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/minigame-canvas-engine/"><img class="vp-site-logo" src="/minigame-canvas-engine/imgs/logo.png" alt><!----></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/wechat-miniprogram/minigame-canvas-engine" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/wechat-miniprogram/minigame-canvas-engine" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/minigame-canvas-engine/" aria-label="概览"><!---->概览<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/minigame-canvas-engine/overview/guide.html" aria-label="安装使用"><!---->安装使用<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/overview/guide.html" aria-label="快速入门"><!---->快速入门<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/overview/plugin.html" aria-label="微信小游戏插件"><!---->微信小游戏插件<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading active" href="/minigame-canvas-engine/tutorial/cocos2.x.html" aria-label="教程"><!---->教程<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/tutorial/cocos2.x.html" aria-label="cocos2.x版本适配"><!---->cocos2.x版本适配<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/tutorial/loading.html" aria-label="加载中效果实现"><!---->加载中效果实现<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/tutorial/platform.html" aria-label="平台适配"><!---->平台适配<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/tutorial/templateengine.html" aria-label="模板引擎使用"><!---->模板引擎使用<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/minigame-canvas-engine/api/tween.html" aria-label="缓动系统"><!---->缓动系统<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/tutorial/updateViewPort.html" aria-label="跨引擎事件处理"><!---->跨引擎事件处理<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/minigame-canvas-engine/demos/invite.html" aria-label="更多示例"><!---->更多示例<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/demos/invite.html" aria-label="邀请好友组件"><!---->邀请好友组件<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/demos/rank.html" aria-label="好友排行榜"><!---->好友排行榜<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/minigame-canvas-engine/api/api.html" aria-label="API 文档"><!---->API 文档<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/api/api.html" aria-label="Layout"><!---->Layout<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/overview.html" aria-label="布局和样式"><!---->布局和样式<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/element.html" aria-label="组件"><!---->组件<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/element.html" aria-label="Element"><!---->Element<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/view.html" aria-label="View"><!---->View<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/image.html" aria-label="Image"><!---->Image<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/text.html" aria-label="Text"><!---->Text<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/bitmapfont.html" aria-label="BitMapText"><!---->BitMapText<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/canvas.html" aria-label="Canvas"><!---->Canvas<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/components/scrollview.html" aria-label="ScrollView"><!---->ScrollView<!----></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/minigame-canvas-engine/plugin/guide.html" aria-label="插件机制"><!---->插件机制<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/plugin/guide.html" aria-label="概览"><!---->概览<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/minigame-canvas-engine/plugin/richtext.html" aria-label="富文本插件"><!---->富文本插件<!----></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/minigame-canvas-engine/CHANGELOG.html" aria-label="更新日志"><!---->更新日志<!----></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="缓动系统" tabindex="-1"><a class="header-anchor" href="#缓动系统"><span>缓动系统</span></a></h1><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>缓动动画是很常见的需求，游戏引擎一般会内置缓动系统，如果没有内置的缓动系统，通过引入缓动引擎也能够很容易实现缓动动画能力。</p><p>出于代码体积考虑，Layout 没有默认挂载了缓动模块，但引用并使用 <a href="https://github.com/tweenjs/tween.js/" target="_blank" rel="noopener noreferrer">tween.js</a> 来实现动画能力与浏览器的 DOM 动画差异不大。</p><h2 id="简单示例" tabindex="-1"><a class="header-anchor" href="#简单示例"><span>简单示例</span></a></h2><p>下面分别是示例需要的 xml、style 和缓动函数调用示例，省略 Layout 初始化和 layout 等逻辑。</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ball<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  container<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    width<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line">    height<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line">    backgroundColor<span class="token operator">:</span> &#39;#ffffff&#39;<span class="token punctuation">,</span></span>
<span class="line">    justContent<span class="token operator">:</span> &#39;center&#39;<span class="token punctuation">,</span></span>
<span class="line">    alignItems<span class="token operator">:</span> &#39;center&#39;<span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  ball<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    backgroundColor<span class="token operator">:</span> &#39;blue&#39;<span class="token punctuation">,</span></span>
<span class="line">    width<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span></span>
<span class="line">    height<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span></span>
<span class="line">    borderRadius<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span></span>
<span class="line">    top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 安装引用缓动库，tween.js 只是推荐使用，可以使用任意缓动引擎</span>
<span class="line"> * npm i @tweenjs/tween.js@^18</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token constant">TWEEN</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@tweenjs/tween.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 将缓动系统的 update 逻辑加入 Layout 的帧循环</span></span>
<span class="line">Layout<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token constant">TWEEN</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> ball <span class="token operator">=</span> Layout<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&#39;ball&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>ball<span class="token punctuation">.</span>style<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">250</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Bounce<span class="token punctuation">.</span>Out<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在线示意如下：</p><iframe height="558.9735717773438" style="width:100%;" scrolling="no" title="Layout Tween" src="https://codepen.io/yuanzm/embed/OJBMqOZ?default-tab=html%2Cresult&amp;editable=true" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true"> See the Pen <a href="https://codepen.io/yuanzm/pen/OJBMqOZ"> Layout Tween</a> by yuanzm (<a href="https://codepen.io/yuanzm">@yuanzm</a>) on <a href="https://codepen.io">CodePen</a>. </iframe><h2 id="接口限制" tabindex="-1"><a class="header-anchor" href="#接口限制"><span>接口限制</span></a></h2><p>借助缓动引擎主要是能够实现两类动画：</p><ol><li>改变位置相关动画: 如示例所示，改变 <strong>style.left</strong>、<strong>style.top</strong>、<strong>style.right</strong>、<strong>style.bottom</strong> 即可，特别注意的是，left/top/right/bottom默认是没有值的，需要指定个默认值缓动才能够生效。</li><li>改变布局的动画：更改 <strong>style.width</strong>、<strong>style.height</strong>等会改变布局的属性，布局属性列表可见<a href="/api/style.html#%E5%B8%83%E5%B1%80" target="_blank" rel="noopener noreferrer">布局属性</a>;</li></ol><h2 id="原理简介" tabindex="-1"><a class="header-anchor" href="#原理简介"><span>原理简介</span></a></h2><p>Layout 要实现缓动动画的原理与浏览器是类似的，浏览器里面一般要给 DOM 节点实现动画能力需要先给节点设置 position 为 relative 或者 absolute，然后定时改变节点的 top 和 left 的值就实现了动画的效果。</p><p>详见文档：<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Web/CSS/position</a></p><blockquote><p>The element is positioned according to the normal flow of the document, and then offset relative to itself based on the values of top, right, bottom, and left. The offset does not affect the position of any other elements;</p></blockquote><p>可以简单理解为，当布局已经确定之后，改变元素的 top 和 left 属性，只会影响自己不会影响其他元素。</p><p>Layout 里面实现动画也是类似的，当改变元素的 style 属性，Layout 内部在监听到这种修改之后，会触发布局的重计算并重新渲染(这个过程被称为 reflow)，只要合理利用 <code>TWEEN</code>，也能实现丰富的动画效果。</p><h2 id="进阶指南" tabindex="-1"><a class="header-anchor" href="#进阶指南"><span>进阶指南</span></a></h2><p>原理部分提到了，动画其实是在改变 style 的属性，这会触发 reflow 操作，reflow 的核心耗时在于布局引擎需要根据改变的属性局部重新计算布局，而布局引擎是 js 实现的，因此性能问题会更加明显。</p><p>因此在做缓动的时候，尤其需要注意性能问题，假设有一个长的滚动列表，列表的每一行都有一个按钮，每个按钮都会执行个放大缩小的按钮（呼吸态按钮），那么对布局引擎而言，基本上整个布局都需要重新计算，这个耗时会非常夸张（600个节点，耗时约15ms)。</p><p>解决方案在于，减少不必要的缓动动画，上面的场景只针对 ScrollView 内可见列表执行缓动，示意代码如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * tween不直接作用于节点，否则一个列表大量的节点都执行tween操作性能必然会差</span>
<span class="line"> * 因此维护一个与节点无关的 globalTween，每帧检查是 globalTween 应该作用于哪些节点</span>
<span class="line"> * 每次 Layout.clear 记得清理或者重置 globalTween</span>
<span class="line"> */</span></span>
<span class="line"><span class="token keyword">let</span> globalStyle <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">new</span> <span class="token class-name">TWEEN<span class="token punctuation">.</span>Tween</span><span class="token punctuation">(</span>globalStyle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">70</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">yoyo</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span><span class="token constant">TWEEN</span><span class="token punctuation">.</span>Easing<span class="token punctuation">.</span>Bounce<span class="token punctuation">.</span>Out<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> scrollList <span class="token operator">=</span> Layout<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&#39;list&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> listItems <span class="token operator">=</span> Layout<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&#39;listHeadImg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 如果 ScrollView 的布局也会改变，比如改变 height，那么 scrollRect 也需要反复获取，此处示例默认滚动列表的窗口不会改变</span></span>
<span class="line"><span class="token keyword">const</span> scrollRect <span class="token operator">=</span> scrollList<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">manualTween</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  listItems<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollRect<span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> globalStyle<span class="token punctuation">.</span>height<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 记得在必要的时候执行 Layout.ticker.remove(manualTween)，比如每次 Layout.init 之前</span></span>
<span class="line">Layout<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>manualTween<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="一些参考资料" tabindex="-1"><a class="header-anchor" href="#一些参考资料"><span>一些参考资料</span></a></h2><ol><li><a href="https://www.w3school.com.cn/js/js_htmldom_animate.asp" target="_blank" rel="noopener noreferrer">JavaScript HTML DOM 动画</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/position" target="_blank" rel="noopener noreferrer">CSS positon</a></li></ol></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/wechat-miniprogram/minigame-canvas-engine/edit/main/api/tween.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/minigame-canvas-engine/tutorial/templateengine.html" aria-label="模板引擎使用"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>模板引擎使用</span></div></a><a class="route-link auto-link next" href="/minigame-canvas-engine/tutorial/updateViewPort.html" aria-label="跨引擎事件处理"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>跨引擎事件处理</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/minigame-canvas-engine/assets/app-BF_eLkLB.js" defer></script>
  </body>
</html>
